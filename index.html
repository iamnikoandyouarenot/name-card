<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åç‰‡ç®¡ç†ä¸­å¿ƒ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #06d6a0;
            --primary-dark: #00b890;
            --accent: #3b82f6;
            --bg-dark: #0f172a;
            --bg-card: rgba(255,255,255,0.06);
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: rgba(255,255,255,0.1);
            --danger: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* èƒŒæ™¯è£é£¾ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(6, 214, 160, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 80% 80%, rgba(59, 130, 246, 0.08) 0%, transparent 40%);
            pointer-events: none;
            z-index: 0;
        }

        /* Header */
        .header {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 16px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            box-shadow: 0 4px 20px rgba(6, 214, 160, 0.3);
        }

        .logo-text h1 {
            font-size: 20px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .logo-text p {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 16px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
            border: none;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 15px rgba(6, 214, 160, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(6, 214, 160, 0.4);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.15);
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.1);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* æœå°‹å€ */
        .search-section {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            background: rgba(255,255,255,0.08);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .search-box input:focus {
            border-color: var(--primary);
        }

        .search-box input::placeholder {
            color: var(--text-muted);
        }

        .search-box::before {
            content: 'ğŸ”';
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
        }

        /* åˆ†é¡æ¨™ç±¤ */
        .categories {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            background: rgba(255,255,255,0.08);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .category-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-color: transparent;
            font-weight: 600;
        }

        /* ä¸»å…§å®¹ */
        .main {
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* çµ±è¨ˆå¡ç‰‡ */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: 14px;
            padding: 16px;
            border: 1px solid var(--border);
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
        }

        .stat-value.primary { color: var(--primary); }
        .stat-value.accent { color: var(--accent); }

        /* åç‰‡ç¶²æ ¼ */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
        }

        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            border-color: rgba(6, 214, 160, 0.3);
        }

        .card-category {
            position: absolute;
            top: 16px;
            right: 16px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 14px;
        }

        .card-avatar {
            width: 50px;
            height: 50px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: 700;
        }

        .card-name {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .card-title {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .card-company {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .card-contacts {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .card-contact {
            font-size: 13px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-line {
            background: rgba(6, 214, 160, 0.1);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(6, 214, 160, 0.2);
            color: var(--primary);
            font-weight: 500;
        }

        .card-notes {
            margin-top: 12px;
            padding: 10px;
            background: rgba(255,255,255,0.04);
            border-radius: 8px;
            font-size: 12px;
            color: var(--text-muted);
            border-left: 3px solid var(--border);
        }

        /* åˆ†é¡é¡è‰² */
        .cat-å®¢æˆ¶ { background: #fef3c7; color: #92400e; border-color: #f59e0b; }
        .cat-ä¾›æ‡‰å•† { background: #dbeafe; color: #1e40af; border-color: #3b82f6; }
        .cat-åˆä½œå¤¥ä¼´ { background: #dcfce7; color: #166534; border-color: #22c55e; }
        .cat-åŒäº‹ { background: #fae8ff; color: #86198f; border-color: #d946ef; }
        .cat-æœ‹å‹ { background: #ffedd5; color: #9a3412; border-color: #f97316; }
        .cat-å…¶ä»– { background: #f1f5f9; color: #334155; border-color: #64748b; }

        .avatar-å®¢æˆ¶ { background: linear-gradient(135deg, #f59e0b, #fef3c7); color: #92400e; }
        .avatar-ä¾›æ‡‰å•† { background: linear-gradient(135deg, #3b82f6, #dbeafe); color: #1e40af; }
        .avatar-åˆä½œå¤¥ä¼´ { background: linear-gradient(135deg, #22c55e, #dcfce7); color: #166534; }
        .avatar-åŒäº‹ { background: linear-gradient(135deg, #d946ef, #fae8ff); color: #86198f; }
        .avatar-æœ‹å‹ { background: linear-gradient(135deg, #f97316, #ffedd5); color: #9a3412; }
        .avatar-å…¶ä»– { background: linear-gradient(135deg, #64748b, #f1f5f9); color: #334155; }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            border-radius: 20px;
            padding: 28px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border);
            box-shadow: 0 40px 80px rgba(0,0,0,0.5);
            transform: translateY(20px);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-header h2 {
            font-size: 22px;
            font-weight: 700;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: var(--text-secondary);
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .form-input {
            width: 100%;
            padding: 12px 14px;
            background: rgba(255,255,255,0.08);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 14px;
            outline: none;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            border-color: var(--primary);
        }

        .form-input.highlight {
            background: rgba(6, 214, 160, 0.1);
            border-color: rgba(6, 214, 160, 0.3);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        select.form-input {
            cursor: pointer;
        }

        textarea.form-input {
            resize: vertical;
            min-height: 80px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .form-actions .btn {
            flex: 1;
            justify-content: center;
            padding: 14px;
        }

        /* æ‹ç…§å€ */
        .camera-section {
            margin-bottom: 20px;
            padding: 16px;
            background: rgba(255,255,255,0.04);
            border-radius: 12px;
            border: 2px dashed var(--border);
        }

        .camera-preview {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 8px;
            display: none;
            margin-bottom: 12px;
        }

        .camera-preview.active {
            display: block;
        }

        .camera-btns {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .camera-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px;
            border-radius: 10px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .camera-btn.capture {
            background: linear-gradient(135deg, var(--accent), #2563eb);
            color: white;
        }

        .camera-btn.recognize {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .camera-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #cameraInput {
            display: none;
        }

        /* OCR çµæœ */
        .ocr-result {
            margin-top: 12px;
            padding: 12px;
            background: rgba(6, 214, 160, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(6, 214, 160, 0.2);
            font-size: 13px;
            display: none;
        }

        .ocr-result.active {
            display: block;
        }

        .ocr-result h4 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .ocr-text {
            color: var(--text-secondary);
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-all;
        }

        /* è©³ç´°æª¢è¦– */
        .detail-header {
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
        }

        .detail-avatar {
            width: 70px;
            height: 70px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            font-weight: 700;
        }

        .detail-info h2 {
            font-size: 26px;
            margin-bottom: 4px;
        }

        .detail-info p {
            color: var(--text-secondary);
            font-size: 15px;
        }

        .detail-category {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 8px;
        }

        .detail-section {
            background: rgba(255,255,255,0.04);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .detail-row {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.06);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-row-icon {
            font-size: 18px;
            margin-right: 12px;
        }

        .detail-row-label {
            width: 70px;
            font-size: 13px;
            color: var(--text-muted);
        }

        .detail-row-value {
            flex: 1;
            font-size: 14px;
        }

        .detail-row-value a {
            color: var(--text-primary);
            text-decoration: none;
        }

        .detail-row-value a:hover {
            color: var(--primary);
        }

        .detail-row-value.line {
            color: var(--primary);
            font-weight: 500;
        }

        .detail-notes {
            background: rgba(255,255,255,0.04);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .detail-notes h4 {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .detail-notes p {
            font-size: 14px;
            line-height: 1.6;
        }

        /* ç©ºç‹€æ…‹ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 60px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        /* é€šçŸ¥ */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--primary);
            color: white;
            padding: 14px 28px;
            border-radius: 12px;
            font-weight: 500;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 300;
            transition: transform 0.3s;
        }

        .notification.active {
            transform: translateX(-50%) translateY(0);
        }

        .notification.error {
            background: var(--danger);
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* åŒæ­¥ç‹€æ…‹ */
        .sync-status {
            font-size: 12px;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .sync-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
        }

        .sync-dot.syncing {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* RWD */
        @media (max-width: 600px) {
            .header-top {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }

            .header-actions {
                justify-content: stretch;
            }

            .header-actions .btn {
                flex: 1;
                justify-content: center;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: repeat(3, 1fr);
            }

            .stat-card {
                padding: 12px;
            }

            .stat-value {
                font-size: 22px;
            }
        }
    </style>
</head>
<body>
    <!-- é€šçŸ¥ -->
    <div id="notification" class="notification"></div>

    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <div class="logo">
                <div class="logo-icon">ğŸ“‡</div>
                <div class="logo-text">
                    <h1>åç‰‡ç®¡ç†ä¸­å¿ƒ</h1>
                    <p>ğŸ“· æ‹ç…§è¾¨è­˜ Â· ğŸ’¬ LINE æ•´åˆ Â· â˜ï¸ é›²ç«¯åŒæ­¥</p>
                </div>
            </div>
            <div class="header-actions">
                <div class="sync-status">
                    <span class="sync-dot" id="syncDot"></span>
                    <span id="syncText">å·²åŒæ­¥</span>
                </div>
                <button class="btn btn-secondary" onclick="syncFromSheet()">ğŸ”„ åŒæ­¥</button>
                <button class="btn btn-primary" onclick="openAddModal()">â• æ–°å¢</button>
            </div>
        </div>
        <div class="search-section">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="æœå°‹å§“åã€å…¬å¸ã€LINE ID..." oninput="filterCards()">
            </div>
            <div class="categories" id="categories">
                <button class="category-btn active" data-cat="å…¨éƒ¨" onclick="selectCategory(this)">å…¨éƒ¨</button>
                <button class="category-btn" data-cat="å®¢æˆ¶" onclick="selectCategory(this)">å®¢æˆ¶</button>
                <button class="category-btn" data-cat="ä¾›æ‡‰å•†" onclick="selectCategory(this)">ä¾›æ‡‰å•†</button>
                <button class="category-btn" data-cat="åˆä½œå¤¥ä¼´" onclick="selectCategory(this)">åˆä½œå¤¥ä¼´</button>
                <button class="category-btn" data-cat="åŒäº‹" onclick="selectCategory(this)">åŒäº‹</button>
                <button class="category-btn" data-cat="æœ‹å‹" onclick="selectCategory(this)">æœ‹å‹</button>
                <button class="category-btn" data-cat="å…¶ä»–" onclick="selectCategory(this)">å…¶ä»–</button>
            </div>
        </div>
    </header>

    <!-- ä¸»å…§å®¹ -->
    <main class="main">
        <!-- çµ±è¨ˆ -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">ğŸ“Š ç¸½åç‰‡æ•¸</div>
                <div class="stat-value" id="totalCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ğŸ’¬ æœ‰ LINE</div>
                <div class="stat-value primary" id="lineCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ğŸ” æœå°‹çµæœ</div>
                <div class="stat-value accent" id="filterCount">0</div>
            </div>
        </div>

        <!-- åç‰‡åˆ—è¡¨ -->
        <div class="cards-grid" id="cardsGrid"></div>
    </main>

    <!-- æ–°å¢/ç·¨è¼¯ Modal -->
    <div class="modal-overlay" id="addModal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modalTitle">â• æ–°å¢åç‰‡</h2>
                <button class="modal-close" onclick="closeAddModal()">âœ•</button>
            </div>

            <!-- æ‹ç…§å€ -->
            <div class="camera-section">
                <img id="cameraPreview" class="camera-preview" alt="åç‰‡é è¦½">
                <input type="file" id="cameraInput" accept="image/*" capture="environment" onchange="handleImageSelect(event)">
                <div class="camera-btns">
                    <button class="camera-btn capture" onclick="document.getElementById('cameraInput').click()">
                        ğŸ“· æ‹ç…§/é¸æ“‡åœ–ç‰‡
                    </button>
                    <button class="camera-btn recognize" id="recognizeBtn" onclick="recognizeCard()" disabled>
                        ğŸ” è¾¨è­˜åç‰‡
                    </button>
                </div>
                <div class="ocr-result" id="ocrResult">
                    <h4>ğŸ“ è¾¨è­˜çµæœ</h4>
                    <div class="ocr-text" id="ocrText"></div>
                </div>
            </div>

            <!-- è¡¨å–® -->
            <form id="cardForm" onsubmit="saveCard(event)">
                <input type="hidden" id="cardId">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ğŸ‘¤ å§“å *</label>
                        <input type="text" class="form-input" id="cardName" placeholder="ç‹å¤§æ˜" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ğŸ“ åˆ†é¡</label>
                        <select class="form-input" id="cardCategory">
                            <option value="å®¢æˆ¶">å®¢æˆ¶</option>
                            <option value="ä¾›æ‡‰å•†">ä¾›æ‡‰å•†</option>
                            <option value="åˆä½œå¤¥ä¼´">åˆä½œå¤¥ä¼´</option>
                            <option value="åŒäº‹">åŒäº‹</option>
                            <option value="æœ‹å‹">æœ‹å‹</option>
                            <option value="å…¶ä»–">å…¶ä»–</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ¢ å…¬å¸</label>
                    <input type="text" class="form-input" id="cardCompany" placeholder="å°ç£ç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸">
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ’¼ è·ç¨±</label>
                    <input type="text" class="form-input" id="cardTitle" placeholder="æ¥­å‹™ç¶“ç†">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">ğŸ“± é›»è©±</label>
                        <input type="tel" class="form-input" id="cardPhone" placeholder="0912-345-678">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ğŸ’¬ LINE ID</label>
                        <input type="text" class="form-input highlight" id="cardLine" placeholder="your_line_id">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">âœ‰ï¸ Email</label>
                    <input type="email" class="form-input" id="cardEmail" placeholder="email@example.com">
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ“ åœ°å€</label>
                    <input type="text" class="form-input" id="cardAddress" placeholder="å°åŒ—å¸‚ä¿¡ç¾©å€...">
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸŒ ç¶²ç«™</label>
                    <input type="text" class="form-input" id="cardWebsite" placeholder="www.example.com">
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ“ å‚™è¨»</label>
                    <textarea class="form-input" id="cardNotes" placeholder="é‡è¦å®¢æˆ¶ï¼Œå–œæ­¡å–å’–å•¡..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddModal()">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary" id="saveBtn">ğŸ’¾ å„²å­˜åç‰‡</button>
                </div>
            </form>
        </div>
    </div>

    <!-- è©³ç´°æª¢è¦– Modal -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal">
            <div class="modal-header">
                <h2>ğŸ“‡ åç‰‡è©³æƒ…</h2>
                <button class="modal-close" onclick="closeDetailModal()">âœ•</button>
            </div>
            <div id="detailContent"></div>
        </div>
    </div>

    <script>
        // ===== è¨­å®š =====
        const CONFIG = {
            VISION_API_KEY: 'AIzaSyDLVs8BwB5Uy0EWl0HSjAwXKxVml1bAv_Y',
            SHEET_ID: '1WcV71Rh8T5uxgce-Nuh5XuO8Fn1Mn1GGLp8cYpmY1oo',
            SHEET_API_KEY: 'AIzaSyDLVs8BwB5Uy0EWl0HSjAwXKxVml1bAv_Y'
        };

        // ===== å…¨åŸŸè®Šæ•¸ =====
        let cards = [];
        let currentCategory = 'å…¨éƒ¨';
        let currentImage = null;
        let editingId = null;

        // ===== åˆå§‹åŒ– =====
        document.addEventListener('DOMContentLoaded', () => {
            loadFromLocal();
            syncFromSheet();
        });

        // ===== é€šçŸ¥ =====
        function showNotification(message, isError = false) {
            const el = document.getElementById('notification');
            el.textContent = message;
            el.className = 'notification active' + (isError ? ' error' : '');
            setTimeout(() => el.className = 'notification', 3000);
        }

        // ===== æœ¬åœ°å„²å­˜ =====
        function loadFromLocal() {
            const saved = localStorage.getItem('businessCards');
            if (saved) {
                cards = JSON.parse(saved);
                renderCards();
            }
        }

        function saveToLocal() {
            localStorage.setItem('businessCards', JSON.stringify(cards));
        }

        // ===== Google Sheets åŒæ­¥ =====
        async function syncFromSheet() {
            const dot = document.getElementById('syncDot');
            const text = document.getElementById('syncText');
            dot.className = 'sync-dot syncing';
            text.textContent = 'åŒæ­¥ä¸­...';

            try {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SHEET_ID}/values/A:K?key=${CONFIG.SHEET_API_KEY}`;
                const res = await fetch(url);
                const data = await res.json();

                if (data.values && data.values.length > 1) {
                    const headers = data.values[0];
                    cards = data.values.slice(1).map((row, index) => ({
                        id: row[0] || String(Date.now() + index),
                        name: row[1] || '',
                        company: row[2] || '',
                        title: row[3] || '',
                        phone: row[4] || '',
                        email: row[5] || '',
                        lineId: row[6] || '',
                        category: row[7] || 'å…¶ä»–',
                        address: row[8] || '',
                        website: row[9] || '',
                        notes: row[10] || ''
                    })).filter(c => c.name);

                    saveToLocal();
                    renderCards();
                    showNotification('âœ… åŒæ­¥æˆåŠŸï¼');
                }
            } catch (err) {
                console.error('åŒæ­¥å¤±æ•—:', err);
                showNotification('åŒæ­¥å¤±æ•—ï¼Œä½¿ç”¨æœ¬åœ°è³‡æ–™', true);
            }

            dot.className = 'sync-dot';
            text.textContent = 'å·²åŒæ­¥';
        }

        async function saveToSheet(card, isNew = true) {
            const dot = document.getElementById('syncDot');
            dot.className = 'sync-dot syncing';

            try {
                // ä½¿ç”¨ Google Apps Script Web App ä¾†å¯«å…¥
                // é€™è£¡å…ˆå­˜æœ¬åœ°ï¼Œæç¤ºç”¨æˆ¶æ‰‹å‹•åŒæ­¥
                saveToLocal();
                
                // é¡¯ç¤ºæç¤º
                showNotification('âœ… å·²å„²å­˜ï¼è«‹åˆ° Google Sheets ç¢ºèª');
                
            } catch (err) {
                console.error('å„²å­˜åˆ°é›²ç«¯å¤±æ•—:', err);
                showNotification('å·²å­˜æœ¬åœ°ï¼Œé›²ç«¯åŒæ­¥å¤±æ•—', true);
            }

            dot.className = 'sync-dot';
        }

        // ===== æ¸²æŸ“åç‰‡ =====
        function renderCards() {
            const grid = document.getElementById('cardsGrid');
            const filtered = filterCardsList();

            // æ›´æ–°çµ±è¨ˆ
            document.getElementById('totalCount').textContent = cards.length;
            document.getElementById('lineCount').textContent = cards.filter(c => c.lineId).length;
            document.getElementById('filterCount').textContent = filtered.length;

            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <h3>${cards.length === 0 ? 'é‚„æ²’æœ‰ä»»ä½•åç‰‡' : 'æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„åç‰‡'}</h3>
                        <p>${cards.length === 0 ? 'é»æ“Šã€Œæ–°å¢ã€é–‹å§‹å»ºç«‹æ‚¨çš„äººè„ˆåº«' : 'è©¦è©¦å…¶ä»–æœå°‹æ¢ä»¶'}</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filtered.map(card => `
                <div class="card" onclick="openDetailModal('${card.id}')">
                    <span class="card-category cat-${card.category}">${card.category}</span>
                    <div class="card-header">
                        <div class="card-avatar avatar-${card.category}">${card.name.charAt(0)}</div>
                        <div>
                            <div class="card-name">${escapeHtml(card.name)}</div>
                            <div class="card-title">${escapeHtml(card.title) || 'â€”'}</div>
                        </div>
                    </div>
                    ${card.company ? `<div class="card-company">ğŸ¢ ${escapeHtml(card.company)}</div>` : ''}
                    <div class="card-contacts">
                        ${card.phone ? `<div class="card-contact">ğŸ“± ${escapeHtml(card.phone)}</div>` : ''}
                        ${card.lineId ? `<div class="card-contact card-line">ğŸ’¬ LINE: ${escapeHtml(card.lineId)}</div>` : ''}
                        ${card.email ? `<div class="card-contact">âœ‰ï¸ ${escapeHtml(card.email)}</div>` : ''}
                    </div>
                    ${card.notes ? `<div class="card-notes">ğŸ“ ${escapeHtml(card.notes.substring(0, 50))}${card.notes.length > 50 ? '...' : ''}</div>` : ''}
                </div>
            `).join('');
        }

        function filterCardsList() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            return cards.filter(card => {
                const matchSearch = !search || 
                    card.name.toLowerCase().includes(search) ||
                    card.company.toLowerCase().includes(search) ||
                    card.title.toLowerCase().includes(search) ||
                    card.lineId.toLowerCase().includes(search) ||
                    card.notes.toLowerCase().includes(search) ||
                    card.email.toLowerCase().includes(search);
                const matchCategory = currentCategory === 'å…¨éƒ¨' || card.category === currentCategory;
                return matchSearch && matchCategory;
            });
        }

        function filterCards() {
            renderCards();
        }

        function selectCategory(btn) {
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentCategory = btn.dataset.cat;
            renderCards();
        }

        // ===== æ–°å¢/ç·¨è¼¯ Modal =====
        function openAddModal() {
            editingId = null;
            document.getElementById('modalTitle').textContent = 'â• æ–°å¢åç‰‡';
            document.getElementById('cardForm').reset();
            document.getElementById('cardId').value = '';
            document.getElementById('cameraPreview').className = 'camera-preview';
            document.getElementById('ocrResult').className = 'ocr-result';
            document.getElementById('recognizeBtn').disabled = true;
            currentImage = null;
            document.getElementById('addModal').classList.add('active');
        }

        function openEditModal(id) {
            const card = cards.find(c => c.id === id);
            if (!card) return;

            editingId = id;
            document.getElementById('modalTitle').textContent = 'âœï¸ ç·¨è¼¯åç‰‡';
            document.getElementById('cardId').value = card.id;
            document.getElementById('cardName').value = card.name;
            document.getElementById('cardCompany').value = card.company;
            document.getElementById('cardTitle').value = card.title;
            document.getElementById('cardPhone').value = card.phone;
            document.getElementById('cardEmail').value = card.email;
            document.getElementById('cardLine').value = card.lineId;
            document.getElementById('cardCategory').value = card.category;
            document.getElementById('cardAddress').value = card.address;
            document.getElementById('cardWebsite').value = card.website;
            document.getElementById('cardNotes').value = card.notes;
            document.getElementById('cameraPreview').className = 'camera-preview';
            document.getElementById('ocrResult').className = 'ocr-result';

            closeDetailModal();
            document.getElementById('addModal').classList.add('active');
        }

        function closeAddModal() {
            document.getElementById('addModal').classList.remove('active');
        }

        // ===== è©³ç´° Modal =====
        function openDetailModal(id) {
            const card = cards.find(c => c.id === id);
            if (!card) return;

            const content = document.getElementById('detailContent');
            content.innerHTML = `
                <div class="detail-header">
                    <div class="detail-avatar avatar-${card.category}">${card.name.charAt(0)}</div>
                    <div class="detail-info">
                        <h2>${escapeHtml(card.name)}</h2>
                        <p>${escapeHtml(card.title) || 'â€”'}</p>
                        <span class="detail-category cat-${card.category}">${card.category}</span>
                    </div>
                </div>
                <div class="detail-section">
                    ${card.company ? `
                    <div class="detail-row">
                        <span class="detail-row-icon">ğŸ¢</span>
                        <span class="detail-row-label">å…¬å¸</span>
                        <span class="detail-row-value">${escapeHtml(card.company)}</span>
                    </div>` : ''}
                    ${card.phone ? `
                    <div class="detail-row">
                        <span class="detail-row-icon">ğŸ“±</span>
                        <span class="detail-row-label">é›»è©±</span>
                        <span class="detail-row-value"><a href="tel:${card.phone}">${escapeHtml(card.phone)}</a></span>
                    </div>` : ''}
                    ${card.lineId ? `
                    <div class="detail-row">
                        <span class="detail-row-icon">ğŸ’¬</span>
                        <span class="detail-row-label">LINE</span>
                        <span class="detail-row-value line"><a href="https://line.me/ti/p/~${card.lineId}" target="_blank">${escapeHtml(card.lineId)}</a></span>
                    </div>` : ''}
                    ${card.email ? `
                    <div class="detail-row">
                        <span class="detail-row-icon">âœ‰ï¸</span>
                        <span class="detail-row-label">Email</span>
                        <span class="detail-row-value"><a href="mailto:${card.email}">${escapeHtml(card.email)}</a></span>
                    </div>` : ''}
                    ${card.address ? `
                    <div class="detail-row">
                        <span class="detail-row-icon">ğŸ“</span>
                        <span class="detail-row-label">åœ°å€</span>
                        <span class="detail-row-value">${escapeHtml(card.address)}</span>
                    </div>` : ''}
                    ${card.website ? `
                    <div class="detail-row">
                        <span class="detail-row-icon">ğŸŒ</span>
                        <span class="detail-row-label">ç¶²ç«™</span>
                        <span class="detail-row-value"><a href="${card.website.startsWith('http') ? card.website : 'https://' + card.website}" target="_blank">${escapeHtml(card.website)}</a></span>
                    </div>` : ''}
                </div>
                ${card.notes ? `
                <div class="detail-notes">
                    <h4>ğŸ“ å‚™è¨»</h4>
                    <p>${escapeHtml(card.notes)}</p>
                </div>` : ''}
                <div class="form-actions">
                    <button class="btn btn-danger" onclick="deleteCard('${card.id}')">ğŸ—‘ï¸ åˆªé™¤</button>
                    <button class="btn btn-primary" onclick="openEditModal('${card.id}')">âœï¸ ç·¨è¼¯</button>
                </div>
            `;
            document.getElementById('detailModal').classList.add('active');
        }

        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('active');
        }

        // ===== å„²å­˜åç‰‡ =====
        async function saveCard(e) {
            e.preventDefault();

            const card = {
                id: editingId || String(Date.now()),
                name: document.getElementById('cardName').value.trim(),
                company: document.getElementById('cardCompany').value.trim(),
                title: document.getElementById('cardTitle').value.trim(),
                phone: document.getElementById('cardPhone').value.trim(),
                email: document.getElementById('cardEmail').value.trim(),
                lineId: document.getElementById('cardLine').value.trim(),
                category: document.getElementById('cardCategory').value,
                address: document.getElementById('cardAddress').value.trim(),
                website: document.getElementById('cardWebsite').value.trim(),
                notes: document.getElementById('cardNotes').value.trim()
            };

            if (!card.name) {
                showNotification('è«‹è¼¸å…¥å§“å', true);
                return;
            }

            if (editingId) {
                const index = cards.findIndex(c => c.id === editingId);
                if (index !== -1) cards[index] = card;
                showNotification('âœ… åç‰‡å·²æ›´æ–°ï¼');
            } else {
                cards.unshift(card);
                showNotification('âœ… åç‰‡å·²æ–°å¢ï¼');
            }

            saveToLocal();
            renderCards();
            closeAddModal();

            // æç¤ºåŒæ­¥åˆ° Google Sheets
            appendToSheet(card);
        }

        // ===== æ–°å¢åˆ° Google Sheets =====
        async function appendToSheet(card) {
            try {
                // ç”±æ–¼ API Key åªèƒ½è®€å–ï¼Œå¯«å…¥éœ€è¦ OAuth æˆ– Apps Script
                // é€™è£¡æä¾›ä¸€å€‹ç°¡å–®çš„æ–¹å¼ï¼šé–‹å•Ÿ Google Sheets è®“ç”¨æˆ¶æ‰‹å‹•ç¢ºèª
                console.log('æ–°åç‰‡è³‡æ–™:', card);
                
                // å»ºç«‹è¦è¤‡è£½çš„æ–‡å­—
                const rowData = [
                    card.id,
                    card.name,
                    card.company,
                    card.title,
                    card.phone,
                    card.email,
                    card.lineId,
                    card.category,
                    card.address,
                    card.website,
                    card.notes
                ].join('\t');

                // è¤‡è£½åˆ°å‰ªè²¼ç°¿
                await navigator.clipboard.writeText(rowData);
                showNotification('ğŸ“‹ å·²è¤‡è£½ï¼è«‹åˆ° Google Sheets è²¼ä¸Š');

            } catch (err) {
                console.error('è¤‡è£½å¤±æ•—:', err);
            }
        }

        // ===== åˆªé™¤åç‰‡ =====
        function deleteCard(id) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å¼µåç‰‡å—ï¼Ÿ')) return;

            cards = cards.filter(c => c.id !== id);
            saveToLocal();
            renderCards();
            closeDetailModal();
            showNotification('ğŸ—‘ï¸ åç‰‡å·²åˆªé™¤');
        }

        // ===== æ‹ç…§è™•ç† =====
        function handleImageSelect(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                currentImage = event.target.result;
                const preview = document.getElementById('cameraPreview');
                preview.src = currentImage;
                preview.className = 'camera-preview active';
                document.getElementById('recognizeBtn').disabled = false;
            };
            reader.readAsDataURL(file);
        }

        // ===== OCR è¾¨è­˜ =====
        async function recognizeCard() {
            if (!currentImage) return;

            const btn = document.getElementById('recognizeBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> è¾¨è­˜ä¸­...';

            try {
                const base64 = currentImage.split(',')[1];
                const response = await fetch(
                    `https://vision.googleapis.com/v1/images:annotate?key=${CONFIG.VISION_API_KEY}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            requests: [{
                                image: { content: base64 },
                                features: [{ type: 'TEXT_DETECTION', maxResults: 1 }]
                            }]
                        })
                    }
                );

                const data = await response.json();
                
                if (data.responses && data.responses[0].textAnnotations) {
                    const text = data.responses[0].textAnnotations[0].description;
                    document.getElementById('ocrText').textContent = text;
                    document.getElementById('ocrResult').className = 'ocr-result active';

                    // æ™ºæ…§è§£æåç‰‡
                    parseBusinessCard(text);
                    showNotification('âœ… è¾¨è­˜å®Œæˆï¼');
                } else {
                    showNotification('ç„¡æ³•è¾¨è­˜æ–‡å­—ï¼Œè«‹é‡æ–°æ‹ç…§', true);
                }

            } catch (err) {
                console.error('OCR å¤±æ•—:', err);
                showNotification('è¾¨è­˜å¤±æ•—: ' + err.message, true);
            }

            btn.disabled = false;
            btn.innerHTML = 'ğŸ” è¾¨è­˜åç‰‡';
        }

        // ===== æ™ºæ…§è§£æåç‰‡ =====
        function parseBusinessCard(text) {
            const lines = text.split('\n').map(l => l.trim()).filter(l => l);

            // Email
            const emailMatch = text.match(/[\w.-]+@[\w.-]+\.\w+/);
            if (emailMatch) {
                document.getElementById('cardEmail').value = emailMatch[0];
            }

            // é›»è©± (å°ç£æ ¼å¼)
            const phoneMatch = text.match(/(?:0\d{1,2}[-\s]?\d{3,4}[-\s]?\d{3,4})|(?:\+?886[-\s]?\d{1,2}[-\s]?\d{3,4}[-\s]?\d{3,4})|(?:09\d{2}[-\s]?\d{3}[-\s]?\d{3})/);
            if (phoneMatch) {
                document.getElementById('cardPhone').value = phoneMatch[0];
            }

            // LINE ID (å¸¸è¦‹æ ¼å¼)
            const lineMatch = text.match(/(?:LINE|Line|line)[\s:ï¼š]*([\w._-]+)/i);
            if (lineMatch) {
                document.getElementById('cardLine').value = lineMatch[1];
            }

            // ç¶²ç«™
            const websiteMatch = text.match(/(?:www\.[\w.-]+\.\w+)|(?:https?:\/\/[\w.-]+\.\w+)/i);
            if (websiteMatch) {
                document.getElementById('cardWebsite').value = websiteMatch[0];
            }

            // å˜—è©¦æ‰¾å‡ºå§“å (é€šå¸¸æ˜¯ç¬¬ä¸€è¡Œæˆ–åŒ…å«ä¸­æ–‡å­—çš„çŸ­è¡Œ)
            for (const line of lines) {
                // è·³éåŒ…å«ç‰¹æ®Šç¬¦è™Ÿçš„è¡Œ
                if (line.includes('@') || line.includes('www') || line.match(/\d{4,}/)) continue;
                // ä¸­æ–‡å§“åé€šå¸¸ 2-4 å€‹å­—
                if (/^[\u4e00-\u9fa5]{2,4}$/.test(line)) {
                    document.getElementById('cardName').value = line;
                    break;
                }
            }

            // å˜—è©¦æ‰¾å…¬å¸åç¨± (åŒ…å«ã€Œå…¬å¸ã€ã€Œä¼æ¥­ã€ã€Œæœ‰é™ã€ç­‰)
            const companyLine = lines.find(l => 
                l.includes('å…¬å¸') || l.includes('ä¼æ¥­') || l.includes('æœ‰é™') || 
                l.includes('è‚¡ä»½') || l.includes('é›†åœ˜') || l.includes('å·¥ä½œå®¤') ||
                l.includes('Co.') || l.includes('Corp') || l.includes('Inc') || l.includes('Ltd')
            );
            if (companyLine) {
                document.getElementById('cardCompany').value = companyLine;
            }

            // å˜—è©¦æ‰¾è·ç¨± (åŒ…å«ã€Œç¶“ç†ã€ã€Œç¸½ç›£ã€ã€Œä¸»ç®¡ã€ç­‰)
            const titleLine = lines.find(l => 
                l.includes('ç¶“ç†') || l.includes('ç¸½ç›£') || l.includes('ä¸»ç®¡') ||
                l.includes('å°ˆå“¡') || l.includes('æ¥­å‹™') || l.includes('å·¥ç¨‹å¸«') ||
                l.includes('è¨­è¨ˆå¸«') || l.includes('ç¸½è£') || l.includes('åŸ·è¡Œé•·') ||
                l.includes('Director') || l.includes('Manager') || l.includes('CEO') ||
                l.includes('Engineer') || l.includes('Designer')
            );
            if (titleLine) {
                document.getElementById('cardTitle').value = titleLine;
            }

            // åœ°å€ (åŒ…å«ã€Œå¸‚ã€ã€Œå€ã€ã€Œè·¯ã€ã€Œè¡—ã€ç­‰)
            const addressLine = lines.find(l => 
                (l.includes('å¸‚') || l.includes('ç¸£')) && 
                (l.includes('å€') || l.includes('é„‰') || l.includes('é®')) &&
                (l.includes('è·¯') || l.includes('è¡—') || l.includes('å··'))
            );
            if (addressLine) {
                document.getElementById('cardAddress').value = addressLine;
            }
        }

        // ===== å·¥å…·å‡½æ•¸ =====
        function escapeHtml(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        // ===== éµç›¤äº‹ä»¶ =====
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeAddModal();
                closeDetailModal();
            }
        });

        // é»æ“ŠèƒŒæ™¯é—œé–‰ Modal
        document.getElementById('addModal').addEventListener('click', (e) => {
            if (e.target.id === 'addModal') closeAddModal();
        });
        document.getElementById('detailModal').addEventListener('click', (e) => {
            if (e.target.id === 'detailModal') closeDetailModal();
        });
    </script>
</body>
</html>
